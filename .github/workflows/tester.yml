name: Automated Testing
on: 
  push:
    branches:
    - '**'

  pull_request:
    branches:
    - main


jobs:
  lint-code:
    name: lint the code
    runs-on: ubuntu-latest
    steps:
    - name: check code
      uses: actions/checkout@v4
      
    - name: installs python
      uses: actions/setup-python@v5

    - run: | 
        echo Checking python version running... 
        python3 --version
    
    - run: |
        echo installing dependencies...
        bash ${GITHUB_WORKSPACE}/scripts/installing_dependencies.sh
        pip install pylint

    - name: lint code
      run: |
          bash ${GITHUB_WORKSPACE}/scripts/pylint_directories.sh
          

  install-python:
        name: installs python and runs pytest on all directories
        runs-on: ubuntu-latest
        steps:
        - uses: actions/checkout@v4

        - name: installs python
          uses: actions/setup-python@v5

        - run: | 
            echo Checking python version running... 
            python3 --version
            
        - run: |
            echo installing dependencies...
            bash ${GITHUB_WORKSPACE}/scripts/installing_dependencies.sh
            pip install pytest

        - run: |
            echo running pytest on the all folders...
            cd movie_db
            pwd
            pytest test_api.py
        env:
            DATABASE_USERNAME: ${{secrets.DATABASE_USERNAME}}
            DATABASE_PASSWORD: ${{secrets.DATABASE_PASSWORD}}
            DATABASE_IP: ${{secrets.DATABASE_IP}}
            DATABASE_PORT: ${{secrets.DATABASE_PORT}}
            DATABASE_NAME: ${{secrets.DATABASE_NAME}}


